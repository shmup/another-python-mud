<html>
<head>
<link rel=StyleSheet href="style/style.css" type="text/css" media=screen>
<script type="text/javascript" src="scripts/jquery-1.7.2.min.js"></script> 
<script language = "javascript">
//idea 1: Server sends a "windowed" view of the map. This windowed view is 0 based, regardless of the actual coordinate the user is at
//Sub-idea 1: The server only sends the differences from the last request, not the full map


var map_diff;				

var ws = new WebSocket("ws://localhost:8888/websocket");

ws.onopen = function() {
   ws.send("Nicholas");
   ws.send("a");
   ws.send("l");
};

ws.onmessage = function (evt) {
   if(evt.data.substring(0, 5) == '{"gam')
   {
	map_diff = window.JSON.parse(evt.data)
   }
   
   
    
};


mapnum = 0

function change_map(){
	
	var map = map_diff
	for(var tile in map.gamemap)
	{
		
		$("#"+tile).removeClass( "tile0 tile1 tile2 tile3", false )
		$("#"+tile).addClass( "tile"+map.gamemap[tile], true )
	}
	ws.send("dig 1 e");
	ws.send("l");
}



$(document).ready(function() {
for(var j = 0; j < 19; j++)
{
	$("<div/>", { "class":"tile-row", "id": "row"+j }).appendTo(".map-box");
	for(var i = 0; i < 33; i++)
	{
		$("<div>", {"class":"tile tile0", "id":i+"_"+j}).html("#").appendTo("#row"+j);
	}
}
   


window.setInterval(change_map, 1000);

});

</script>
</head>

<body>
<div class = "map-box"></div>
</body>
</html>